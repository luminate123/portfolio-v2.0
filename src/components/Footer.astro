---
const currentYear = new Date().getFullYear();
---

<!-- Section title -->
<div class="col-span-full flex items-center gap-4 py-4 animate-on-scroll" id="contact">
    <h2 class="text-2xl md:text-3xl font-bold text-white whitespace-nowrap">Contacto</h2>
    <div class="h-px flex-1 bg-gradient-to-r from-white/10 to-transparent"></div>
</div>

<!-- Contact form tile — spans 3 cols -->
<div class="bento-tile col-span-full lg:col-span-3 p-6 md:p-8 animate-on-scroll">
    <h3 class="text-xl md:text-2xl font-bold mb-2">
        <span class="gradient-text">¿Listo para trabajar juntos?</span>
    </h3>
    <p class="text-sm text-zinc-400 mb-6">Estoy abierto a nuevas oportunidades y colaboraciones.</p>
    
    <form class="contact-form flex flex-col gap-3" action="https://formspree.io/f/mbdarzre" method="POST">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="flex flex-col gap-1.5">
                <label for="contact-name" class="text-xs text-zinc-500 font-medium">Nombre</label>
                <input id="contact-name" name="Nombre" type="text" placeholder="Tu nombre" required
                    class="w-full px-4 py-2.5 rounded-xl border border-white/8 bg-white/4 text-white text-sm outline-none focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/20 transition-all placeholder-zinc-600" />
            </div>
            <div class="flex flex-col gap-1.5">
                <label for="contact-email" class="text-xs text-zinc-500 font-medium">Correo</label>
                <input id="contact-email" name="Correo" type="email" placeholder="tu@email.com" required
                    class="w-full px-4 py-2.5 rounded-xl border border-white/8 bg-white/4 text-white text-sm outline-none focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/20 transition-all placeholder-zinc-600" />
            </div>
        </div>
        <div class="flex flex-col gap-1.5">
            <label for="contact-message" class="text-xs text-zinc-500 font-medium">Mensaje</label>
            <textarea id="contact-message" name="Mensaje" rows="4" placeholder="Cuéntame sobre tu proyecto" required
                class="w-full px-4 py-2.5 rounded-xl border border-white/8 bg-white/4 text-white text-sm outline-none focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/20 transition-all resize-y min-h-[100px] placeholder-zinc-600"></textarea>
        </div>
        <button type="submit" class="self-start px-6 py-2.5 rounded-xl bg-gradient-to-r from-blue-500 to-cyan-500 text-white text-sm font-semibold hover:-translate-y-0.5 transition-all shadow-lg shadow-blue-500/25 hover:shadow-blue-500/40 cursor-pointer border-none mt-1">
            Enviar mensaje
        </button>
    </form>
</div>

<!-- CTA / info tile -->
<div class="bento-tile col-span-full lg:col-span-1 p-6 flex flex-col justify-between animate-on-scroll" style="animation-delay: 0.1s">
    <div>
        <div class="w-10 h-10 rounded-xl bg-blue-500/10 border border-blue-500/20 flex items-center justify-center mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
        </div>
        <h4 class="text-base font-semibold text-white mb-2">Email directo</h4>
        <p class="text-sm text-zinc-400 leading-relaxed mb-4">También puedes escribirme directamente por email si lo prefieres.</p>
    </div>
    <a href="mailto:sebastian@email.com" class="text-sm text-blue-400 hover:text-blue-300 font-medium transition-colors flex items-center gap-1.5">
        Enviar email
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
    </a>
</div>

<!-- Footer bottom — full width -->
<div class="col-span-full text-center py-6 border-t border-white/5 mt-4 animate-on-scroll">
    <p class="text-xs text-zinc-600 mb-1">&copy; {currentYear} Sebastian Senmache. Todos los derechos reservados.</p>
    <p class="text-xs text-zinc-700 flex items-center justify-center gap-1">
        Construido con <span class="text-red-400 animate-pulse">❤</span> usando Astro
    </p>
</div>

<!-- Back to top -->
<button class="back-to-top" aria-label="Volver arriba">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>
</button>

<!-- Toast notification -->
<div class="toast" role="status" aria-live="polite">
    <div class="flex flex-col gap-0.5">
        <span class="text-sm font-semibold text-white">¡Mensaje enviado!</span>
        <span class="text-xs text-zinc-400">Gracias, te responderé lo antes posible.</span>
    </div>
    <button class="toast-close text-zinc-500 text-lg leading-none cursor-pointer bg-transparent border-none" aria-label="Cerrar">×</button>
</div>

<script>
    const backToTopBtn = document.querySelector(".back-to-top");
    const toast = document.querySelector(".toast");
    const toastClose = document.querySelector(".toast-close");
    const contactForm = document.querySelector(".contact-form");

    window.addEventListener("scroll", () => {
        if (window.scrollY > 500) {
            backToTopBtn?.classList.add("visible");
        } else {
            backToTopBtn?.classList.remove("visible");
        }
    });

    backToTopBtn?.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
    });

    const showToast = () => {
        toast?.classList.add("visible");
        window.setTimeout(() => toast?.classList.remove("visible"), 5000);
    };

    toastClose?.addEventListener("click", () => toast?.classList.remove("visible"));

    contactForm?.addEventListener("submit", async (event) => {
        event.preventDefault();
        const form = event.currentTarget as HTMLFormElement;
        const formData = new FormData(form);
        try {
            const response = await fetch(form.action, {
                method: "POST",
                headers: { Accept: "application/json" },
                body: formData,
            });
            if (response.ok) {
                form.reset();
                showToast();
            }
        } catch (error) {}
    });
</script>

<style>
    .back-to-top {
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        width: 44px;
        height: 44px;
        background: linear-gradient(135deg, #3b82f6, #06b6d4);
        border: none;
        border-radius: 50%;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transform: translateY(60px);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 99;
        box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
    }

    .back-to-top.visible {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .back-to-top:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.6);
    }

    .toast {
        position: fixed;
        right: 1.5rem;
        bottom: 1.5rem;
        background: rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 0.75rem;
        padding: 0.75rem 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        box-shadow: 0 16px 30px rgba(0, 0, 0, 0.4);
        opacity: 0;
        transform: translateY(20px);
        pointer-events: none;
        transition: opacity 0.3s ease, transform 0.3s ease;
        z-index: 120;
        backdrop-filter: blur(10px);
    }

    .toast.visible {
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
    }

    @media (max-width: 640px) {
        .toast {
            right: 0.75rem;
            left: 0.75rem;
            bottom: 0.75rem;
        }
    }
</style>
